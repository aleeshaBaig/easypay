
  <div class="row">
      <br>
		<div class="col-md-2">
	  <%= form_with url: "/utility_bills", id: "reset", method: :get do |form| %>
	    <div data-controller="category">
			<%= form.collection_select :utility_bill_category_id, UtilityBillCategory.all, :id, :name, { prompt: "Filter by Category" }, class: "form-control", id: "utility_bill_category_id" %>
		  </div>
		</div>
    <div class="col-md-2">
        <%= form.collection_select :company_id, [], :id, :name, { prompt: "Filter by Company" }, class: "form-control", id: "company_id" %>
    </div>
    <div class="col-md-2">
       <%= form.text_field :search_text_field, class: "form-control", placeholder: "Search by Customer name", id: "search_text_field" %>
	  </div>
    <div class="col-md-1">
					 <%= form.submit "Search" %>
					 <% end %>

     </div>
    <div class="col-md-1">
      <button id="reset" onclick="myFunction()"  class="focus:outline-none text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-900">Reset</button>
    </div>
    <div class="col-md-1">
    </div>
	  <div class="col-md-1">
	     <%= button_to "Export", utility_bills_url(format: :csv), class: "text-gray-900 bg-gradient-to-r from-lime-200 via-lime-400 to-lime-500 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-lime-300 dark:focus:ring-lime-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2", :method => :get %>
    </div>
    <div class="col-md-1">
		   <%= button_to "Add ", new_utility_bill_url, class: "text-gray-900 bg-gradient-to-r from-lime-200 via-lime-400 to-lime-500 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-lime-300 dark:focus:ring-lime-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2", :method => :get %>
     </div>
  </div>
  <div class="row">
      <h1 class="headingtable" style="background-color: #d5f7cc !important;"><%= link_to "Utilities", utility_bills_url %></h1>
			<table class="table table-striped table-bordered" style="width: -webkit-fill-available;">
			  <tr>   
          <th>Sr. #</th>
          <th>Consumer Id</th>
          <th>Customer Name</th>
          <th>Customer Id </th>
          <th>Nickname</th>
          <th>Category</th>   
          <th>Company</th>
          <th>Nickname</th>
          <th>Expected Reading Day</th>
          <th>Expected Issuance Day</th>
          <th>Expected Due Date</th> 
          <th>Focal Person</th>
          <th>Bills</th>
          <th colspan="2" >Action</th>
        </tr>
        <tbody id ="utility_bill_filter">
        <% @utility_bills.each_with_index do |utility_bill, index| %>
          <tr>
             <td><%= index +1 %></td>
             <td><a href="/utility_bills/<%= utility_bill.id %>"><%= utility_bill.consumer_id %></a></td>
             <td><%= utility_bill.customer_name %></td>
             <td><%= utility_bill.customer_id %></td>
             <td><%= utility_bill.nickname %></td>
             <td><%= utility_bill.utility_bill_category.name %></td>
             <td><%= utility_bill.company.name %></td>
             <td><%= utility_bill.nickname %></td>
             <td><%= utility_bill.expected_reading_day %></td>
             <td><%= utility_bill.expected_issuance_day %></td>
             <td><%= utility_bill.expected_due_day %></td>
             <td><%= utility_bill.focal_person %></td>
             <td><%= link_to "View Bill", bills_path, style: "color:red;" %></td>
             <td><%= link_to raw("<i class=\"material-icons\">edit</i>"), edit_utility_bill_path(utility_bill.id) %> 
                <%= link_to raw("<i class=\"material-icons\">delete</i>"), utility_bill_path(utility_bill.id), data: {
                                                                                                                 turbo_method: :delete, turbo_confirm: "Are you sure?",
                                                                                                               } %> 
             </td>
          </tr>
          <% end %>        </tbody> 
      </table> 
  </div>
</div>

 <script src = "https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js" > </script> 
<script >
    $(document).ready(function() {
        $("#search").on("click", function(e) {
            var utility_bill_category_id = $("#utility_bill_category_id").val();
            var search_by_com = $("#company_id").val();
            var search_text_field = $("#search_text_field").val();
            $.ajax({
                type: "GET",
                url: "/search",
                data: {
                    utility_bill_category_id: utility_bill_category_id,
                    search_by_com: search_by_com,
                    search_text_field: search_text_field
                },
                success: function() {},
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                    alert(XMLHttpRequest, responseText)
                }
            });
        });

    }); 
</script> 
<script >
    $(document).ready(function() {
        $("#utility_bill_category_id").on("change", function(e) {
            const utility_bill_category_id = event.target.value;
            if (utility_bill_category_id != "") {
                $.ajax({
                    type: "GET",
                    url: "/get_companies",
                    data: {
                        utility_bill_category_id: utility_bill_category_id
                    },
                    success: function(response) {
                        if (response.status == true) {
                            $("#company_id option").remove();

                            let rdata = response.data;

                            if (rdata.length > 0) {
                                var row = "<option value=\"" + "" + "\">" + "Select Company" + "</option>";
                                $(row).appendTo("#company_id");
                                //// Fill sub category select
                                $.each(rdata, function(i) {
                                    console.log(rdata[i])
                                    row = "<option value=\"" + rdata[i].id + "\">" + rdata[i].name + "</option>";
                                    $(row).appendTo("#company_id");
                                });
                            } else {
                                var row = "<option value=\"" + "" + "\">" + "Select" + "</option>";
                                $(row).appendTo("#company_id").remove();
                            }
                        }
                    },
                    error: function(data) {
                        $("#company_id").remove();
                        var row = "<option value=\"" + "" + "\">" + "Select" + "</option>";
                        $(row).appendTo("#company_id");
                    }
                });


            } else {
                addRow();


            }



        });

    }); 
</script>
 <script >
    function myFunction() {
        document.getElementById("reset").reset();
        addRow();


    }
		</script>
		 <script >
    function addRow() {
        $("#company_id option").remove();
        var row = "<option value=\"" + "" + "\">" + "Filter by Company" + "</option>";
        $(row).appendTo("#company_id");
    } </script>