<style>
.px-5 {
    padding-right: 2rem!important;
    padding-left: 2rem!important;
}
h1, h2, h3, h4, h5, h6 {
    font-size: 32px;
    font-weight: inherit;
}
.pagination {
    --bs-pagination-padding-x: 0.75rem;
    --bs-pagination-padding-y: 0.375rem;
    --bs-pagination-font-size: 1rem;
    --bs-pagination-color: "black";
    --bs-pagination-bg: #fff;
    --bs-pagination-border-width: 1px;
    --bs-pagination-border-color: #dee2e6;
    --bs-pagination-border-radius: 0.375rem;
    --bs-pagination-hover-color: var(--bs-link-hover-color);
    --bs-pagination-hover-bg: #e9ecef;
    --bs-pagination-hover-border-color: #dee2e6;
    --bs-pagination-focus-color: var(--bs-link-hover-color);
    --bs-pagination-focus-bg: #e9ecef;
    --bs-pagination-focus-box-shadow: 0 0 0 0.25remrgba(13, 110, 253, 0.25);
    --bs-pagination-active-color: #fff;
    --bs-pagination-active-bg: #0d6efd;
    --bs-pagination-active-border-color: #0d6efd;
    --bs-pagination-disabled-color: #6c757d;
    --bs-pagination-disabled-bg: #fff;
    --bs-pagination-disabled-border-color: #dee2e6;
    display: flex;
    padding-left: 0;
    list-style: none;
}
.active>.page-link, .page-link.active {
    z-index: 3;
    color: var(--bs-pagination-active-color);
    background-color: #2c544d;
    border-color: #96a7bf;
}
</style>
<br>
 

<br>
<%= form_with url: "/utility_bills", id: "reset", method: :get do |form| %>
      <div class="row">
          <div class="col-md-2">
	           <div data-controller="category">
                    <% if @utility_bill_category_id.present? %>
                    <%= form.collection_select :utility_bill_category_id, UtilityBillCategory.all, :id, :name, { prompt: true, selected: @utility_bill_category_id }, class: "form-control" %>
                    <% else %>
                    <%= form.collection_select :utility_bill_category_id, UtilityBillCategory.all, :id, :name, { prompt: "Filter by Category" }, class: "form-control", id: "utility_bill_category_id" %>
                    <% end %>
              </div>
         </div>
          <div class="col-md-2">
                    <% if @utility_bill_category_id.present? && @company_id.present? %>
                    <%= form.collection_select :company_id, Company.where(utility_bill_category_id: @utility_bill_category_id), :id, :name, { prompt: true, selected: @company_id }, class: "form-control" %>
                    <% else %>
                    <%= form.collection_select :company_id, [], :id, :name, { prompt: "Filter By Company" }, class: "form-control", id: "company_id" %>
                    <% end %>
          </div>
          <div class="col-md-2">
                    <% if @customer_name %>
                    <%= form.text_field :search_text_field, class: "form-control", placeholder: "Search by Customer name", id: "search_text_field", value: @customer_name %>
                    <% else %>
                    <%= form.text_field :search_text_field, class: "form-control", placeholder: "Search by Customer name", id: "search_text_field" %>
                    <% end %>
          </div>
          <div class="col-md-1">
 	                  <%= form.submit "Search", class: "text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700" %>
          </div>
          <div class="col-md-1">
                    <button  onclick="myFunction()"  class="focus:outline-none text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-900">Reset</button>
          </div>
        <div class="col-md-1">
        </div>
	      <div class="col-md-1" style="margin-left: 128px;">
                    <%= link_to "Export", utility_bills_url(request.parameters.merge({ format: :csv })), download: "utility_bills.csv", class: "text-white bg-gradient-to-r from-green-400 via-green-500 to-green-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-green-300 dark:focus:ring-green-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2" %>
        </div>
    
        <div class="col-md-1">
		                <%= link_to "Add ", new_utility_bill_url, class: " text-white bg-gradient-to-r from-green-400 via-green-500 to-green-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-green-300 dark:focus:ring-green-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2", :method => :get %>
        </div>

    </div>
<% end %>

  <br>
  <div class="row">
  <div class= "col-md-6">
  </div>
  <div class="col-md-4">
  </div>
  <div class="col-md-2">
<%== pagy_bootstrap_nav(@pagy) %>
 

  </div>
  </div>
  <br>
  <div class="row">
      <h1 class="headingtable" style="background-color: #d5f7cc !important;"><%= link_to "Utilities", utility_bills_url %></h1>
			<table class="table table-striped table-bordered" style="width: -webkit-fill-available;">
                <tr>   
                    <th>Sr. #</th>
                    <th>Consumer Id</th>
                    <th>Customer Name</th>
                    <th>Customer Id </th>
                    <th>Nickname</th>
                    <th>Category</th>   
                    <th>Company</th>
                    <th>Nickname</th>
                    <th>Expected Reading Day</th>
                    <th>Expected Issuance Day</th>
                    <th>Expected Due Date</th> 
                    <th>Focal Person</th>
                    <th>Bills</th>
                    <th colspan="2" >Action</th>
                </tr>
        <tbody id ="utility_bill_filter">
        <% @utility_bills.each_with_index do |utility_bill, index| %>
                <tr>
                    <td><%= index +1 %></td>
                    <td><a href="/utility_bills/<%= utility_bill.id %>"><%= utility_bill.consumer_id %></a></td>
                    <td><%= utility_bill.customer_name %></td>
                    <td><%= utility_bill.customer_id %></td>
                    <td><%= utility_bill.nickname %></td>
                    <td><%= utility_bill.utility_bill_category.name %></td>
                    <td><%= utility_bill.company.name %></td>
                    <td><%= utility_bill.nickname %></td>
                    <td><%= utility_bill.expected_reading_day %></td>
                    <td><%= utility_bill.expected_issuance_day %></td>
                    <td><%= utility_bill.expected_due_day %></td>
                    <td><%= utility_bill.focal_person %></td>
                    <td><%= link_to "View Bill", bills_path, style: "color:red;" %></td>
                    <td><%= link_to raw("<i class=\"material-icons\">edit</i>"), edit_utility_bill_path(utility_bill.id) %> 
                    <%= link_to raw("<i class=\"material-icons\">delete</i>"), utility_bill_path(utility_bill.id), data: {
                                                                                                                     turbo_method: :delete, turbo_confirm: "Are you sure?",
                                                                                                                   } %> 
                    </td>
                </tr>
        <% end %>
         </tbody> 
      </table> 
  </div>
 
 <script src = "https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js" > </script> 
<script>
    $(document).ready(function() {
        $("#search").on("click", function(e) {
            var utility_bill_category_id = $("#utility_bill_category_id").val();
            var search_by_com = $("#company_id").val();
            var search_text_field = $("#search_bar").val();
            $.ajax({
                type: "GET",
                url: "/search",
                data: {
                    utility_bill_category_id: utility_bill_category_id,
                    search_by_com: search_by_com,
                    search_text_field: search_text_field
                },
                success: function() {},
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                    alert(XMLHttpRequest, responseText)
                }
            });
        });

    }); 
</script> 
<script >
    $(document).ready(function() {
        $("#utility_bill_category_id").on("change", function(e) {
            const utility_bill_category_id = event.target.value;
            if (utility_bill_category_id != "") {
                $.ajax({
                    type: "GET",
                    url: "/get_companies",
                    data: {
                        utility_bill_category_id: utility_bill_category_id
                    },
                    success: function(response) {
                        if (response.status == true) {
                            $("#company_id option").remove();

                            let rdata = response.data;

                            if (rdata.length > 0) {
                                var row = "<option value=\"" + "" + "\">" + "Select Company" + "</option>";
                                $(row).appendTo("#company_id");
                                //// Fill sub category select
                                $.each(rdata, function(i) {
                                    console.log(rdata[i])
                                    row = "<option value=\"" + rdata[i].id + "\">" + rdata[i].name + "</option>";
                                    $(row).appendTo("#company_id");
                                });
                            } else {
                                var row = "<option value=\"" + "" + "\">" + "Select" + "</option>";
                                $(row).appendTo("#company_id").remove();
                            }
                        }
                    },
                    error: function(data) {
                        $("#company_id").remove();
                        var row = "<option value=\"" + "" + "\">" + "Select" + "</option>";
                        $(row).appendTo("#company_id");
                    }
                });


            } else {
                addRow();


            }



        });

    }); 
</script>
 <script >
    function myFunction() {
        document.getElementById("reset").reset();
        window.location.replace("http://localhost:3000/utility_bills").reset();
        addRow();


    }
		</script>
		 <script >
    function addRow() {
        $("#company_id option").remove();
        var row = "<option value=\"" + "" + "\">" + "Filter by Company" + "</option>";
        $(row).appendTo("#company_id");
    } </script>
 


